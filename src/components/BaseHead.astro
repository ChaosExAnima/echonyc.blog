---
// Import the global.css file here so that it is included on
// all pages through the use of the <BaseHead /> component.
import '../styles/global.css';

import '@fontsource-variable/source-serif-4';
import type { ImageMetadata } from 'astro';

import sourceSerif4 from '@fontsource-variable/source-serif-4/files/source-serif-4-latin-standard-normal.woff2?url';
import { Seo } from 'astro-seo-meta';
import { getImage } from 'astro:assets';
import colors from 'tailwindcss/colors';

import { FEDI_USER } from '~/lib/constants';
import { toAbsoluteUrl } from '~/lib/urls';

interface Props {
	description: string;
	image?: ImageMetadata;
	title: string;
}

const { description, image, title } = Astro.props;

const canonicalURL = toAbsoluteUrl(Astro.url.pathname);
const themeColor = colors.violet[400];

const fbImage = image
	? await getImage({ format: 'jpg', height: 566, src: image, width: 1080 })
	: null;
const twitterImage = image
	? await getImage({ format: 'jpg', height: 720, src: image, width: 1080 })
	: null;
---

<!-- Global Metadata -->
<meta charset="utf-8" />
<meta content="width=device-width,initial-scale=1" name="viewport" />
<link href="/favicon.svg" rel="icon" type="image/svg+xml" />
<meta content={Astro.generator} name="generator" />
<link href="/sitemap-index.xml" rel="sitemap" />
<link
	href="/rss.xml"
	rel="alternate"
	title="RSS Feed"
	type="application/rss+xml"
/>

<!-- Font preloads -->
<link
	as="font"
	crossorigin="anonymous"
	href={sourceSerif4}
	rel="preload"
	type="font/woff2"
/>

<!-- Canonical URL -->
<link href={canonicalURL} rel="canonical" />

<!-- Primary Meta Tags -->
<Seo
	colorScheme="dark"
	description={description}
	facebook={{
		image: toAbsoluteUrl(fbImage?.src),
		type: 'website',
		url: canonicalURL,
	}}
	keywords={['blog']}
	themeColor={themeColor}
	title={title}
	twitter={{
		card: 'summary_large_image',
		image: toAbsoluteUrl(twitterImage?.src),
	}}
/>

<!-- Fediverse -->
<meta content={FEDI_USER} name="fediverse:creator" />

<!-- CloudFlare -->
<meta
	content={`sec-ch-dpr ${Astro.site}; sec-ch-viewport-width ${Astro.site}`}
	http-equiv="Delegate-CH"
/>
